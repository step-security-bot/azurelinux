From 197f3149a5753d6bc994a21b98a70c7f76f548b5 Mon Sep 17 00:00:00 2001
From: Muhammad Falak R Wani <falakreyaz@gmail.com>
Date: Tue, 14 May 2024 10:47:34 +0530
Subject: [PATCH] gvc: detect plugin installation failure and display an error

Gitlab: fixes #2441
Reported-by: GJDuck

Backported to v2.42.4 by @mfrw

Signed-off-by: Matthew Fernandez <matthew.fernandez@gmail.com>
Signed-off-by: Muhammad Falak R Wani <falakreyaz@gmail.com>
---
 lib/gvc/gvconfig.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/lib/gvc/gvconfig.c b/lib/gvc/gvconfig.c
index 59c4614..35c1b60 100644
--- a/lib/gvc/gvconfig.c
+++ b/lib/gvc/gvconfig.c
@@ -186,6 +186,10 @@ static int gvconfig_plugin_install_from_config(GVC_t * gvc, char *s)
 	do {
 	    api = token(&nest, &s);
 	    gv_api = gvplugin_api(api);
+	    if (gv_api == (api_t)-1) {
+		agerr(AGERR, "config error: %s %s not found\n", path, api);
+		return 0;
+	    }
 	    do {
 		if (nest == 2) {
 		    type = token(&nest, &s);
-- 
2.40.1

